#!/bin/bash

here=`dirname $0`
case "$here" in
/*) ;;
*)  here="`pwd`/$here" ;;
esac

if [ "$#" -lt 2 ]; then
	echo "Usage: $0 <config> <devel release> <cves>" 1>&2
	exit 1
fi
config="$1"
devel="$2"
shift 2

while read series cvebranch repo branch flags X
do
	case ",$flags," in
	*,ignored,*)		;;
	*)			continue ;;
	esac

	echo "$series $cvebranch (ignored) ..."

	if [ "$series" = "$devel" ]; then
		series="devel"
	fi

	egrep "^${series}_${cvebranch}: *needs-triage" "$@" |\
	while IFS=: read cve series_branch state
	do
		#echo ">$cve< >$series_branch< >$state<"
		echo "$cve $series $cvebranch $cve needs-triage -> ignored"
		sed -i "$cve" -e "s/\(^${series}_${cvebranch}:\) *needs-triage */\1 ignored /"
	done
done <"$config"
