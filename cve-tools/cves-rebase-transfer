#!/bin/bash

devel="$1"
shift

while read from tos
do
	from=`echo "$from" | sed -e "s/^${devel}_/devel_/g"`
	echo "FROM: $from" 1>&2
	grep -H "^$from:" "$@" | \
		sed -e 's/:/ /' | \
		while read file dummy state notes
		do
			case "$state" in
			released|not-affected)
				state='pending' ;;
			esac
			case "$state" in
			pending|needed)
				for to in $tos
				do
					to=`echo "$to" | sed -e 's/_/ /'`
					echo "$file $to - $state"
				done
				;;
			esac
		done
done <<EOL
lucid_linux		lucid_linux-ec2
oneiric_linux		lucid_linux-lts-backport-oneiric oneiric_linux-ti-omap4
precise_linux		precise_linux-ti-omap4 precise_linux-armadaxp
quantal_linux		precise_linux-lts-quantal quantal_linux-ti-omap4 quantal_linux-armadaxp raring_linux-ti-omap4 raring_linux-armadaxp
quantal_linux-ti-omap4	raring_linux-ti-omap4
EOL
