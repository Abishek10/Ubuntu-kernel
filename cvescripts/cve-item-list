#!/usr/bin/python
#==============================================================================
# Author: Stefan Bader <stefan.bader@canonical.com>
# Copyright (C) 2010
#
# This script is distributed under the terms and conditions of the GNU General
# Public License, Version 3 or later. See http://www.gnu.org/copyleft/gpl.html
# for details.
#==============================================================================
import sys, os, re
import optparse
from cvescripts_lib import *

parser = optparse.OptionParser(
    '''Usage: %prog [options]'''
)
parser.set_description(
    '''Display all unassigned, in progress and completed work-items from '''
    '''the CVE tracker.'''
)
parser.add_option(
    "--no-update", dest="update", action="store_false", default=True,
    help='''Skip fetching the latest changes from the tracker (default: '''
         '''%default).'''
)
(opts, args) = parser.parse_args()

if opts.update:
    TrackerPull()

workitems = ListWorkItemsToDo()
if not workitems:
    print "II: There are currently no work-items waiting to be processed."
    sys.exit(0)

for wi in workitems:
    assignee = wi.get_assignee()
    if not assignee:
        assignee = "<unassigned>"

    waiting = False
    pending = False
    for (pkg, series) in ListLinuxPackagesAndSeries():
        pkgname = PkgList[series][pkg]
        if wi.is_pkg_waiting(pkgname, series):
            waiting = True
        if wi.is_pkg_pending(pkgname, series):
            pending = True

    status = "in progress"
    if pending and not waiting:
        status = "ready for release"
    elif waiting and assignee == "<unassigned>":
        status = "waiting"

    print "{0:13} {1:20} {2}".format(
        wi.get_candidate(),
        status,
        assignee
    )

# vi:set ts=4 sw=4 expandtab:
