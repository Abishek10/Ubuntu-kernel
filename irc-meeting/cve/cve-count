#!/bin/bash

from_days="7"
if [ "$1" != "" ]; then
	from_days="$1"
fi

from=`date --date="$from_days days ago" +%Y-%m-%d` 

#added=`bzr diff -rdate:$from..date:$to | egrep '^\+devel_linux:' | wc -l`
#removed=`bzr diff -rdate:$from..date:$to | egrep '^\-devel_linux:' | wc -l`

#let new="$added-$removed"
#
#echo "$new"

bzr diff -rdate:$from.. active | \
	egrep '^(\+\+\+|[+-]devel_linux:)' | \
	awk '
		/^\+\+\+/		{ cve=$2 }
		/^\+devel_linux:/	{ cves[cve] += 1; print "+ " $0; }
		/^\-devel_linux:/	{ cves[cve] -= 1; print "- " $0;  }
		END			{
						added=0
						retired=0
						for (cve in cves) {
							if (cves[cve] == 1) {
								added += 1
								print cve " added"
							}
							if (cves[cve] <= 0) {
								retired += 1
								print cve " retired"
							}
						}
						print "added " added " retired " retired
					}
	'

