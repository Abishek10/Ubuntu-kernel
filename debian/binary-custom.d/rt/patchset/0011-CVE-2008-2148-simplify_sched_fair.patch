Subject: sched: simplify sched_slice()

From: Ingo Molnar <mingo@elte.hu>

X-Git-Tag: v2.6.25-rc6~5
X-Git-Url: http://git.kernel.org/?p=linux%2Fkernel%2Fgit%2Ftorvalds%2Flinux-2.6.git;a=commitdiff_plain;h=6a6029b8cefe0ca7e82f27f3904dbedba3de4e06

sched: simplify sched_slice()

Use the existing calc_delta_mine() calculation for sched_slice(). This
saves a divide and simplifies the code because we share it with the
other /cfs_rq->load users.

It also improves code size:

      text    data     bss     dec     hex filename
     42659    2740     144   45543    b1e7 sched.o.before
     42093    2740     144   44977    afb1 sched.o.after

Signed-off-by: Ingo Molnar <mingo@elte.hu>
Signed-off-by: Peter Zijlstra <a.p.zijlstra@chello.nl>
---

 kernel/sched_fair.c |    8 ++------
 1 file changed, 2 insertions(+), 6 deletions(-)

Index: linux-2.6.24.7-rt21/kernel/sched_fair.c
===================================================================
--- linux-2.6.24.7-rt21.orig/kernel/sched_fair.c	2008-10-08 22:22:49.000000000 -0400
+++ linux-2.6.24.7-rt21/kernel/sched_fair.c	2008-10-08 22:22:52.000000000 -0400
@@ -263,12 +263,8 @@ static u64 __sched_period(unsigned long 
  */
 static u64 sched_slice(struct cfs_rq *cfs_rq, struct sched_entity *se)
 {
-	u64 slice = __sched_period(cfs_rq->nr_running);
-
-	slice *= se->load.weight;
-	do_div(slice, cfs_rq->load.weight);
-
-	return slice;
+	return calc_delta_mine(__sched_period(cfs_rq->nr_running),
+			       se->load.weight, &cfs_rq->load);
 }
 
 /*
