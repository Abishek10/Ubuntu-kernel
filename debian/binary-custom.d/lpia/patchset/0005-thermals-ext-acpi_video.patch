#! /bin/sh /usr/share/dpatch/dpatch-run
diff --git a/drivers/acpi/video.c b/drivers/acpi/video.c
index 44a0d9b..18584f2 100644
--- a/drivers/acpi/video.c
+++ b/drivers/acpi/video.c
@@ -298,17 +298,39 @@ static int acpi_video_get_brightness(struct backlight_device *bd)
 	return (int) cur_level;
 }
 
+static int acpi_video_get_brightness_levels(struct backlight_device *bd
+					    , char *buf)
+{
+	int i;
+	struct acpi_video_device *vd =
+		(struct acpi_video_device *)bl_get_data(bd);
+	for (i = 0; i < vd->brightness->count; i++) {
+		buf += sprintf(buf, "%d ", vd->brightness->levels[i]);
+	}
+	buf += sprintf(buf, "\n");
+
+	return 0;
+}
+
 static int acpi_video_set_brightness(struct backlight_device *bd)
 {
+	int i;
 	int request_level = bd->props.brightness;
 	struct acpi_video_device *vd =
 		(struct acpi_video_device *)bl_get_data(bd);
-	acpi_video_device_lcd_set_level(vd, request_level);
-	return 0;
+	for (i = 0; i < vd->brightness->count; i++) {
+		if (request_level == vd->brightness->levels[i]) {
+			acpi_video_device_lcd_set_level(vd, request_level);
+			vd->brightness->curr = request_level;
+			return 0;
+		}
+	}
+	return -EINVAL;
 }
 
 static struct backlight_ops acpi_backlight_ops = {
 	.get_brightness = acpi_video_get_brightness,
+	.get_brightness_levels = acpi_video_get_brightness_levels,
 	.update_status  = acpi_video_set_brightness,
 };
 
@@ -575,6 +597,8 @@ static void acpi_video_device_find_cap(struct acpi_video_device *device)
 	u32 max_level = 0;
 	union acpi_object *obj = NULL;
 	struct acpi_video_device_brightness *br = NULL;
+	unsigned long tmp;
+	struct backlight_device *bd = NULL;
 
 
 	memset(&device->cap, 0, 4);
@@ -652,22 +676,21 @@ static void acpi_video_device_find_cap(struct acpi_video_device *device)
 	kfree(obj);
 
 	if (device->cap._BCL && device->cap._BCM && device->cap._BQC && max_level > 0){
-		unsigned long tmp;
-		static int count = 0;
-		char *name;
-		name = kzalloc(MAX_NAME_LEN, GFP_KERNEL);
-		if (!name)
+		acpi_video_device_lcd_get_level_current(device, &tmp);
+		device->brightness->curr = (int)tmp;
+
+		bd = backlight_device_register(device->dev->pnp.bus_id,
+					       &device->dev->dev
+					       , device
+					       , &acpi_backlight_ops);
+		if (IS_ERR(bd))
 			return;
 
-		sprintf(name, "acpi_video%d", count++);
-		acpi_video_device_lcd_get_level_current(device, &tmp);
-		device->backlight = backlight_device_register(name,
-			NULL, device, &acpi_backlight_ops);
+		device->backlight = bd;
 		device->backlight->props.max_brightness = max_level;
 		device->backlight->props.brightness = (int)tmp;
 		backlight_update_status(device->backlight);
 
-		kfree(name);
 	}
 	if (device->cap._DCS && device->cap._DSS){
 		static int count = 0;
diff --git a/drivers/video/backlight/backlight.c b/drivers/video/backlight/backlight.c
index 4840fe2..de92b74 100644
--- a/drivers/video/backlight/backlight.c
+++ b/drivers/video/backlight/backlight.c
@@ -164,6 +164,20 @@ static ssize_t backlight_show_actual_brightness(struct device *dev,
 	return rc;
 }
 
+static ssize_t backlight_show_brightness_levels(struct class_device *cdev,
+						char *buf)
+{
+	int rc = -ENXIO;
+	struct backlight_device *bd = to_backlight_device(cdev);
+
+	mutex_lock(&bd->ops_lock);
+	if (bd->ops && bd->ops->get_brightness_levels)
+		rc = bd->ops->get_brightness_levels(bd, buf);
+	mutex_unlock(&bd->ops_lock);
+
+	return strlen(buf);
+}
+
 static struct class *backlight_class;
 
 static void bl_device_release(struct device *dev)
@@ -179,6 +193,7 @@ static struct device_attribute bl_device_attributes[] = {
 	__ATTR(actual_brightness, 0444, backlight_show_actual_brightness,
 		     NULL),
 	__ATTR(max_brightness, 0444, backlight_show_max_brightness, NULL),
+	__ATTR(brightness_levels, 0444, backlight_show_brightness_levels, NULL),
 	__ATTR_NULL,
 };
 
diff --git a/include/linux/backlight.h b/include/linux/backlight.h
index 1ee9488..5a2d070 100644
--- a/include/linux/backlight.h
+++ b/include/linux/backlight.h
@@ -11,6 +11,7 @@
 #include <linux/device.h>
 #include <linux/mutex.h>
 #include <linux/notifier.h>
+#include <linux/thermal.h>
 
 /* Notes on locking:
  *
@@ -36,6 +37,8 @@ struct backlight_ops {
 	/* Return the current backlight brightness (accounting for power,
 	   fb_blank etc.) */
 	int (*get_brightness)(struct backlight_device *);
+	/* Return the levels of brightness supported by device */
+	int (*get_brightness_levels)(struct backlight_device  *bd, char *buf);
 	/* Check if given framebuffer device is the one bound to this backlight;
 	   return 0 if not, !=0 if it is. If NULL, backlight always matches the fb. */
 	int (*check_fb)(struct fb_info *);
@@ -71,6 +74,7 @@ struct backlight_device {
 	struct notifier_block fb_notif;
 
 	struct device dev;
+	struct thermal_device *td;
 };
 
 static inline void backlight_update_status(struct backlight_device *bd)
